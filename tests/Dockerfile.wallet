FROM rust:1.75

WORKDIR /app

# Copy the source code
COPY . .

# Build the wallet CLI
RUN cargo build --release --bin icn-wallet-cli

# Create data directory
RUN mkdir -p /wallet-data

# Expose the port
EXPOSE 3000

# Set health check
HEALTHCHECK --interval=10s --timeout=5s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:3000/api/health || exit 1

# Run the wallet API server
CMD ["./target/release/icn-wallet-cli", "--data-dir", "/wallet-data", "serve", "--host", "0.0.0.0", "--port", "3000", "--agoranet-url", "${AGORANET_URL}"] 